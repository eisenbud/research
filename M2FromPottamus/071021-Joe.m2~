restart
--Two smooth surfaces in A^n that meet in an isolated point
--at the origin, and whose union has dim Zar Tan space arbitrarily large dim
restart
load "LocalRings.m2"
--for Z tan spc of dim = n+2:
n=3
S=kk[a,b,x_1..x_n]
i1=ideal(x_1..x_n)
G=(ideal(a,b))^(n-1)
i2=ideal map(S^1, n, (i,j)->x_(j+1)-G_j)
I=intersect(i1,i2)
m=ideal(a,b,x_1..x_n)
gens I%m^2
--tangent space is all of A^(n+2)

-- What is Q for these examples?
--we're looking at a surface in A^(n+2), so need L to be generated by 3 linear forms,
--with intersection 0-dimensional.
codim i2
L=ideal(x_1,x_2,x_3) 
codim (i2+L )
gens gb(i2+L)
degree (J=i2+L)
localResolution (S^1/J)
localResolution Hom(J/(i2^2+L), S^1/J)

degree ((J:((ideal vars S)^4))/J)

m=ideal (a,b,x_1..x_n)
H=Hom(J/(i2^2+L), S^1/J)
for k from 0 to 5 list degree((m^k+J)/J)
for k from 0 to 5 list degree(m^k*H)
gens gb J
i2
L
gens gb(i2+L)




--
restart
--dim of Q for two smooth varieties of dim n meeting in 2n+1-space.
--a plane x=0 of dim n meeting the graph of n+1 general forms on the plane of degree d:
--L = (x_1,\dots,x_(n+1)), I=(x_1-g(a),...x_(n+1)-g_(n+1)(a)) in k[a_1..a_n, x_1..x_(n+1)]
--In the following we work completely mod L. f is the presentation matrix of (I+L)/(I^2+L).
--

test2 =(n,d)->(
print ("--numvars, degree of forms, degree of scheme, dim Q, (deg -dim Q)");
S=kk[a_1..a_n];
J=ideal random(S^1, S^{n+1:-d});
D=degree (S^1/J);
R=S/J;
f=R**(presentation module J);
E=degree kernel transpose f;
--the length of Q is (n+1)*d-E
print (n,d,D, E, E-n*D, (n+1)*D-E)
)


     -- used 1.12 seconds

i3 : time test2(6,2)
--numvars, degree of forms, degree of scheme, dim Q, (deg -dim Q), dim Q
(6, 2, 35, 238, 28)
time test2(5,2)
--(5, 2, 20, 100, 0) 20
time test2(6,2)
--(6, 2, 35, 238, 28) 7=n+1
time test2(7,2)
--(7, 2, 70, 503, 13) 57=n*(n+1)+1
time test2(8,2)
(8, 2, 126, 1125, 117) 9=n+1 -- 55 sec on the Mac Pro
time test2(9,2)
(9, 2, 252, 2429, 161) 91=n*(n+1)+1
     -- used 10844.6 seconds (Is this possible? It ran successfully overnight.)
     
--What about squares and 1 general quadric?

test3 =(n,d)->(
print ("--numvars, degree of forms, degree of scheme, dim Q, (deg -dim Q)");
S=kk[x_1..x_n];
J1=ideal (vars S)^[2];
J=J1+ideal random(S^1, S^{1:-d});
D=degree (S^1/J);
R=S/J;
f=R**(presentation module J);
E=degree kernel transpose f;
print (n,d,D, E, E-n*D, (n+1)*D-E)
)

time test3(5,2)
--(5, 2, 20, 100, 0, 20)
     -- used 0.091979 seconds
time test3(6,2)
--(6, 2, 35, 238, 28, 7)
     -- used 0.071371 seconds
time test3(7,2)
--(7, 2, 70, 503, 13, 57)
     -- used 1.34821 seconds
time test3(8,2)
--(8, 2, 126, 1125, 117, 9)
     -- used 5.93927 seconds
time test3(9,2)
--(9, 2, 252, 2429, 161, 91)
     -- used 221.975 seconds
i9 : time test3(10,2)
(10, 2, 462, 5071, 451, 11)
     -- used 3898.74 seconds

time test3(5,2)
time test3(6,2)
time test3(7,2)
time test3(8,2)
time test3(9,2)
time test3(10,2)

