--Some ways to use symmetricKernel:load "/u/de/m2/rees.m2"--The routines isGenerated and isAnnihilated check the conclusions--of some conjectures in work of DE and Bernd Ulrich (from 5/02).isGenerated=f->(     -- checks whether the torsion in the symmetric algebra of      --the image of the matrix f over the polynomial ring S     --is generated in degree (0,*) (that is, by elements     --that are pure polynomials in the "new" generators of     --the symmetric algebra, corresponding to the columns of f.I0=ideal(0_(ring f));i=symmetricKernel(I0,f);numorig=rank source vars ring f;j=(ideal(vars(ring i))_{0..numorig-1})*              (ideal(vars ring i)_{numorig..(numorig+(rank source f)-1)})^2;0==diff(gens j, gens i) -- is 0 iff the generation is correct.)torsionGenerators=f->(     -- Assumes f is a matrix over a polynomial ring.     --computes the torsion in the symmetric algebra of the     --image of f.I0=ideal(0_(ring f));transpose gens symmetricKernel(I0,f))isAnnihilated = f->(--     tests whether the symmetric algebra torsion is annihilated--     by the maximal ideal of the base ring. If it is also--     generated in degree (0,*), then this annihilation is equiv alent--     to its being concentrated in degrees (0,*).I0=ideal(0_(ring f));i=symmetricKernel(I0, f);L=ideal((gens i)_{0..rank source syz f -1});firstvars=ideal((vars ring i)_{0..2});0==(gens((firstvars)*i))%(L))kk=ZZ/32003Sa=kk[a,b,c]T=kk[a,b,c,d]S=kk[x,y,z]///restartload "/u/de/m2/ulrich-5-5-02.m2"use S--Example: all the cubics but xyzf=gens (I=ideal (x^3,x^2*y, x*y^2, y^3,y^2*z, y*z^2, z^3, z^2*x, z*x^2))torsionGenerators fisGenerated fisAnnihilated f--satisfies generation and annihilation conjectures.--Quartics--Example: all quartics but y^4, yz3, z4. Has Linear resolution.transpose (m=gens(ideal vars S)^4)f= m_{0..9,11..12}isGenerated f--satisfies generation conjecture.torsionGenerators fisAnnihilated f--satisfies annihilation conjecture.--two holes:I1=ideal m_{0..3,5..7,9..14}betti res I1--NOT linearly presented.i=I1linearity (F=res prune module i)betti Flinearity (F=res prune module i^2)betti Flinearity (F=res prune module i^3)betti F--Quintics------Counterexample!!----------define the idealtranspose (m=gens(ideal vars S)^5)f= m_{1..3,5..10,12,14,16..19}--this is all the monoms exceptm_{0,4,11,13,15}betti res coker fisGenerated fisAnnihilated f--This ideal satisfies the "generation" conjecture,--but fails the annihilation conjecture.--check lin type on punct spect. By symmetry, enough to check--lin type after setting z=1.--So: this seems to be an ideal that is:--satisfies the generation conj but NOT the annihilation--conjecture, as the Rees alg relations mod the Symm alg relations--are not killed by the max ideal of the ground ring. (But the square--does annihilate.)--generically a comp int on the punct spect.--linear presentation, but not lin 2nd syzygies and not CMo125 = total: 1 15 20 6           0: 1  .  . .           1: .  .  . .           2: .  .  . .           3: .  .  . .           4: . 15 20 3           5: .  .  . 3------------------------variations:--define the ideal and cojmpute the symmetric kerneltranspose (m=gens(ideal vars S)^5)I=(ideal m_{1..3,5..10,12,14,16..19}) -- the original counterex. 3 holes, --3 powers also missing.I=(ideal m_{0,1..3,5..10,12,14,16..19}) -- add x5. Also a counterexI=(ideal m_{0,1..3,5..10,12,14,15,16..19,20}) --cx add x5,y5,z5. Also a cxI=(ideal m_{0,1..3,5..10,11,12,14,15,16..19,20}) --cx add x5,y5,z5 and xy3z.I=(ideal m_{0,1..3,4,5..10,11,12,14,15,16..19,20}) -- add x5,y5,z5, xy3z,x3yz. NOT a cx.f=gens IisGenerated fbetti res coker fisAnnihilated f--------------------------5-7-02 example:use Si1=ideal(x,z)i2=y^3*(i1^6)+x^3*z^3*(ideal(y,z))^3+ideal(x^5*y^4,y^4*z^5)betti res i2f=gens i2isGenerated fisAnnihilated f--FAILS! (not of lin type on the punct spect.)---------use Si1=x^3*((ideal(y,z))^5)i2=y^3*z^3*((ideal(x,z))^2)f=mingens (i1+i2+ideal(x^4*y^4, y^4*z^4, x*y^3*z^4))betti res coker fisGenerated fisAnnihilated flinTypePS=f->(--Check whether image of f is lin type on the punct spect (3 variables!!)(rank source mingens substitute(ideal f, matrix{{1,y,z}}))<=2 and(rank source mingens substitute(ideal f, matrix{{x,1,z}}))<=2 and(rank source mingens substitute(ideal f, matrix{{x,y,1}}))<=2)linTypePS f----------use Si1=y^4*z*((ideal(x,z))^3)i2=z^3*x*y*((ideal(x,y))^3)i3=x^4*z*((ideal(y,z))^3)f=mingens(i1+i2+i3+ideal(x^3*y^5))betti res coker fisGenerated fisAnnihilated flinTypePS f------Character of linearly presented ideals in 4 varsS=kk[a,b,c,d]m5=(ideal vars S)^5rem = ideal(a*b*c*d^2, a*b*c^2*d)mat= compress ((gens m5) % rem)betti res coker matisGenerated mat--linear presentation. So:Conjecture: A set $B$ in the n-dimensional simplex $\Delta$of monomials of degree d generatesand ideal with linear presentation iff the full subcomplex  of $\Delta$ spanned by the complement $C$ of $B$ has the property that if any n-1-simplex lies in $C$,then the "dual position" n-simplex it generates alsolies in $C$.----------------m=matrix{{z,y,x,0,0},     	  {0,x,y,z,0},	  {0,0,x,y,0},	  {0,0,0,x,y}}f=gens minors(4,m)     betti res coker fisGenerated fbetti res ((ideal f)^3)transpose fuse SsymmetricKernel(ideal(0_(ring f)), f)transpose gens oo-----kk=ZZ/32003T=kk[a,b,c,d]use Tm=random(T^4,T^{4:-1})f=gens minors(3, m)betti res coker fisGenerated fisAnnihilated fsymmetricKernel(ideal(0_(ring f)), f)------use Sm=matrix{{a,b,0},{0,a^2,b^2}}f=gens minors(2,m)isGenerated f -- should be false!torsionGenerators fbetti res ((minors(2,m))^2)betti res coker f--S=kk[vars(0..11)]use Sm=genericMatrix(S,S_0,3,4)f=gens minors(2,m)betti res (coker f, LengthLimit=>2)isGenerated ftorsionGenerators fisAnnihilated f----cases of points in the plane-6points as 2 fat points. oops -- lies on a quadric, so--it can't be 3x3 of a linear 3x4.S=kk[a,b,c]ideal(random(S^1,S^{-1,-2}))f= gens intersect((ideal(a^2,b^2)), ideal(random(S^1,S^{-1,-2})))isGenerated fisAnnihilated f---------------------Could it be that the k-th power of a linearly presented--ideal satisfies N_k? Simplest case is: in n vars, the --(n-1) power of a lin pres ideal primary ideal is a power of the max--ideal. This special case is true for monomial primary ideals!--eg: codim 2 ideal. If the depths of the lower order minors are--high, ok. Try the opposite case:restartkk=ZZ/32003S=kk[a..e]m=matrix{{a,b,0,0,0},         {0,b,c,0},	 {0,0,0,c,d},	 {0,b,c,d,e}}i=minors(4,m)m=matrix{{a,b,0},         {0,a,b}}i=minors(2,m)isLinear res i--------------truncated regular sequencestest=(n,d)->(     S=kk[vars(0..n-1)];     i=sum(0..n-1, i->ideal(S_i^d));     truncate(2*d-1,i))i=test(6,4)restarttestr=(n,m)->(     kk:=ZZ/32003;     T:=kk[x_1..x_n];     i:=ideal random(T^1, T^{n:-m});     ideal mingens truncate(2*m-1,i))i=testr(4,2)betti ifor t from 1 to 2 do print  betti res (i^t)betti res (i^3)--------random reg sequ of degs a, b in n varskk=ZZ/32003n=4a=2b=3i=truncate---------------kk=ZZ/32003S=kk[x_1..x_9]M=genericMatrix(S,x_1,3,3)-----------restartkk=ZZ/32003S=kk[a..f]j=intersect(ideal(a,b,c*f-d*e), ideal(c,d,a*f-b*e))betti res j--------restartS=kk[a,b,c,d]m=random(S^4,S^{4:-1})i=minors(3,m)betti mingens i^3betti res ibetti res i^3betti res (ideal vars S)^6-----------------------------------------------Examples with lin res whose--square does NOT have lin pres-- all these are 3-regular.kk=ZZ/32003S=kk[a..d]--From Conca, "Simplest: 4 vars, 5 cubic gens, codim 2, 3-linear"I2=ideal(a^2*b, a^2*c, a*c^2, b*c^2, a*c*d);codim I2  -- =2betti res I2 -- linear, of length 3betti res I2^2 -- not even linear presentation.prune Ext^4(S^1/(I2^2), S)betti res I2^6primaryDecomposition(I2, Strategy=>Monomial)--leaving out a monomial either spoils linearity of I2 OR--makes I2^2 have linear pres.K2=ideal(a^2*b, a^2*c, a*c^2, b*c^2, a*c*d, a^3, c^3);primaryDecomposition(K2,Strategy=>Monomial)betti res K2betti res K2^2T=kk[a,b,c]f=map(T,S, random(T^1, T^{4:-1}))K3=f K2betti res K3betti res K3^2--cutting by a monomial nzd make I2^2 have lin presJ2=ideal(a^2*b, a^2*c, a*c^2, b*c^2, a*b*c); --I2 mod b-dbetti res J2 -- linear resbetti res J2^2 -- linear resReesI2=map(T, ring StorsI2, matrix{{	       a,b,c,d,e,f,$x_0,$x_1,$x_2,$x_3,$x_4}})vars T-- d2X_1X_4-b2X_5^2 generates the "bad" torsion in the symm alg--The ideal I2 is has even linear quotients (i.e.   the sub ideal--generated by the first i generators in the given order has  a linear--resolution for all i).--------------------------------From Conca. Equal to its own Alexander dualS=kk[a..f]I1=ideal( -- 10 square-free cubicsa*b*f, a*c*d, a*e*f, b*c*f, b*c*e,a*c*e, a*c*f, c*e*f, d*e*f, a*b*e)codim I1 -- =3betti res I1 -- linear of length 3 (Cohen-Macaulay)betti res I1^2 -- not even lin presL=decompose I1--ideal of the projective plane in char not 2:i = ideal(a*b*d,a*b*e,a*c*d,a*c*f,a*e*f,b*c*e,b*c*f,b*d*f,c*d*e,d*e*f)betti res ibetti res i^2torsionGenerators gens I1-- but after specializing by 1, has linear powersT=kk[a..e]ST=map(T,S,matrix{{a,b,c,d,e,sum(5,i->T_i)}})I=ST(i)betti res Ibetti res I^2betti res I^5-- b2X_2X_9-d2X_4X_10 generates the "bad" torsion in the symm alg---------------------------------From Sturmfels "Four Counterexamples". Smallest square-free example?I3=ideal(-- 8 square-free cubics     d*e*f, c*e*f, c*d*f, c*d*e, b*e*f, b*c*d, a*c*f, a*d*e)codim I3 -- =2betti res I3 -- linear of length 3betti res I3^2 -- not even lin pres.decompose I3LtorsionGenerators gens I3--a2X_5X_6-b2X_7X_8  generates the "bad" torsion in the symm alg.--Investigation of the torsion in the symmetric algebra--(bigraded)I=I1ReesId=ReesIdeal IT=ring ReesIdnvarsorig = rank source vars ring InvarsT = rank source vars TsymmId=ideal ((vars T)_{nvarsorig..nvarsT-1}*substitute(syz gens I, T))--move to a new T with a bigradingL=degrees ideal vars TL1=L_{0..nvarsorig-1}L2=L_{nvarsorig..nvarsT-1}M= (flatten L1)/(i->toList(1,i,0)) | (flatten L2)/(i->toList(1,0,i)) T1=kk[flatten entries vars T, Degrees=> M]ReesId1=substitute(ReesId, T1)symmId1=substitute(symmId, T1)symmTorsion=prune ((image gens ReesId1)/(image gens symmId1))degrees source presentation symmTorsiondegrees target presentation symmTorsionbetti res symmTorsionannihilator symmTorsion---------------------Are there perfect codim 2 monomial ideals with lin pres--whose square does not have lin pres? in particular, it must--NOT be genericallly CI-- linear presentation means the graph condition...--2x3: the only one that's not generically CI is (a,b)^2--3x4; there seem to be only S=kk[a,b,c,d]m=matrix{{a,b,0,0},{0,a,b,0},{0,0,c,b}}i=minors(3, m)betti res i^2m=matrix{{a,b,0,0},{0,a,b,0},{0,0,b,c}}i=minors(3, m)betti res i^2m=matrix{{a,b,0,0},{0,a,b,0},{0,0,c,d}}i=minors(3, m)betti res i^2m=matrix{{c,a,0,0,0,0,0},{0,c,a,0,0,0,0},{0,0,c,b,0,0,0},{0,0,0,c,b,0,0},{0,0,b,0,0,a,0},{0,0,0,0,0,c,a}}i=minors(6, m)codim ibetti res ibetti res i^2codim minors(5,m)isGenerated gens iisAnnihilated gens i -------kk=ZZ/32003load "rees.m2"T=kk[x,y,z]M=matrix{{x,0,0,0},{y,x,0,0},{0,y,x,0},{0,0,z,x},{0,0,0,z}}M=matrix{{x,0,0,0},{y,x,0,0},{0,y,x-y,0},{0,0,z,x-y},{0,0,0,z}}j=minors(4,M)codim jbetti symmetricKernel(ideal(0_T), gens j)--Why doesn't this work??block=(S,a,b,wide,firstskip, secondskip)->(     map(S^(wide+1+firstskip+secondskip),	  S^{wide:-1}, 	  zeromat(S,firstskip, wide)||	  map(S^(3+1), S^{3:-1}, (i,j)->	  if i==j then x else	  if i==j+1 then y else 0_S)||	  zeromat(S,firstskip, wide)))block(S,x,y,3,1,2)zeromat=(S,r,c)->     map(S^r, S^{c:-1},(i,j)->0_S)zeromat(S,3,4)restartS=kk[x,y,z]vars Scatmat=(S,x,y,wide)->(     map(S^(wide+1), S^{wide:-1},(i,j)->	  if i==j then x else 	  if i==j+1 then y else 0_S))catmap(S,x,y,3)map(S^(3+1), S^{3:-1}, (i,j)->	  if i==j then x else	  if i==j+1 then y else 0_S)---f=map(S^7,S^{6:-1},     matrix{{x,0,0,0,0,0},	    {y,x,0,0,0,0},	    {0,y,x,0,0,0},	    {0,0,z,x,0,0},	    {0,0,0,z,x+y,0},	    {0,0,0,0,z,x+y},	    {0,0,0,0,0,z}})i=minors(6,f)     codim iload "rees.m2"j=symmetricKernel(ideal(0_S), gens i)betti mingens jtranspose gens jT=ring jff=substitute(f,T)Xs=(vars T)_{3..9}xs=(vars T)_{0..2}D=diff(xs, transpose (Xs*ff))jj= ideal(D*(transpose xs))+         minors(3,D)+         minors(2,(transpose D)_{0,1})+         minors(2,(transpose D)_{2,3})+         minors(2,(transpose D)_{4,5})betti mingens jjcodim jjbetti res jj------restartS=kk[x,y,z]f=map(S^8,S^{7:-1},     matrix{{x,0,0,0,0,0,0},	    {y,x,0,0,0,0,0},	    {0,y,x,0,0,0,0},	    {0,0,z,x,0,0,0},	    {0,0,0,z,x+y,0,0},	    {0,0,0,0,z,x+y,y},	    {0,0,0,0,0,z,x},  	    {0,0,0,0,0,0,z}})i=minors(7,f)     codim iload "rees.m2"j=symmetricKernel(ideal(0_S), gens i)betti mingens jtranspose gens jbetti res jT=ring jff=substitute(f,T)Xs=(vars T)_{3..9}xs=(vars T)_{0..2}D=diff(xs, transpose (Xs*ff))jj= ideal(D*(transpose xs))+         minors(3,D)+         minors(2,(transpose D)_{0,1})+         minors(2,(transpose D)_{2,3})+         minors(2,(transpose D)_{4,5})betti mingens jjcodim jjbetti res jj------restartS=kk[x,y,z]f=map(S^6,S^{5:-1},     matrix{{x,0,0,0,0},	    {y,x,0,0,0},	    {0,y,x,0,0},	    {0,0,z,x,y},	    {0,0,0,z,x},	    {0,0,0,0,z}})i=minors(5,f)     codim iload "rees.m2"j=symmetricKernel(ideal(0_S), gens i)betti mingens jtranspose gens jbetti res jT=ring jff=substitute(f,T)Xs=(vars T)_{3..8}xs=(vars T)_{0..2}D=diff(xs, transpose (Xs*ff))jj= ideal(D*(transpose xs))+         minors(3,D)+         minors(2,(transpose D)_{0,1})+         minors(2,(transpose D)_{2,3})+         minors(2,(transpose D)_{4,5})betti mingens jjcodim jjbetti res jj